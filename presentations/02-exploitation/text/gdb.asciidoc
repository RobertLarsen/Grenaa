Debuggere
---------

...er programmer som overvåger afviklingen af andre programmer.
Kan typisk:

* Disassemble funktioner
* Stoppe afviklingen på en bestemt linje/adresse
* Stoppe afviklingen når noget går galt
* Vise/ændre indholdet af registrene
* Vise/ændre indholdet af hukommelsen

I Unix/Linux verdenen bruger vi `gdb`

GDB - Opstart
-------------

Enten debug et ustartet program:

[source,txt]
---------------------------------
$ gdb ./assignments/integer_conversion
---------------------------------

...eller debug et allerede startet program:

[source,txt]
---------------------------------
$ gdb ./assignments/integer_conversion $(pidof -s integer_conversion)
---------------------------------

GDB - Disassemble
-----------------

[source,txt]
---------------------------------
gef➤  disassemble handle_client 
Dump of assembler code for function handle_client:
   0x0804873d <+0>:     push   ebp
   0x0804873e <+1>:     mov    ebp,esp
   0x08048740 <+3>:     sub    esp,0x168
   0x08048746 <+9>:     mov    DWORD PTR [esp+0x8],0x4
   0x0804874e <+17>:    lea    eax,[ebp-0x14c]
   0x08048754 <+23>:    mov    DWORD PTR [esp+0x4],eax
   0x08048758 <+27>:    mov    eax,DWORD PTR [ebp+0x8]
.....
   0x0804878e <+81>:    mov    eax,DWORD PTR [ebp+0x8]
   0x08048791 <+84>:    mov    DWORD PTR [esp],eax
   0x08048794 <+87>:    call   0x8048530 <read@plt>
   0x08048799 <+92>:    leave  
   0x0804879a <+93>:    ret    
End of assembler dump.
gef➤ 
---------------------------------

GDB - Sæt breakpoint
--------------------

Breakpoints stopper afviklingen når punktet nåes

[source,txt]
---------------------------------
...
   0x08048791 <+84>:    mov    DWORD PTR [esp],eax
   0x08048794 <+87>:    call   0x8048530 <read@plt>
   0x08048799 <+92>:    leave  
   0x0804879a <+93>:    ret    
End of assembler dump.
gef➤  break *0x08048794
Breakpoint 1 at 0x8048794
gef➤ 
---------------------------------

GDB - Kør programmet
--------------------

Hvis programmet ikke allerede kører:

[source,txt]
---------------------------------
gef➤  run
Starting program: /vagrant/presentations/02-exploitation/assignments/integer_conversion
---------------------------------

Hvis vi har attachet til en allerede kørende instans eller er stoppet ved et breakpoint

[source,txt]
---------------------------------
gef➤  continue
Continuing.
---------------------------------

GDB - Vis indhold af registre
-----------------------------
Når breakpointet nåes vises de:

image::../images/gdb-gef-registers.png[]

Derudover kan man bede om dem med:

[source,txt]
---------------------------------
gef➤  info registers eax esp
eax            0x4      0x4
esp            0xfff169f0       0xfff169f0
gef➤
---------------------------------

GDB - Vis indhold af stakken
----------------------------
Når breakpointet nåes vises den:

image::../images/gdb-gef-stack.png[]

Derudover kan man bede om den med:

[source,txt]
---------------------------------
gef➤  x/8xw $esp                                                                                                                              
0xfff16b6c:     0xfff16ba8      0xf7784000      0xfff16b80      0xf76c8741
0xfff16b7c:     0x08048a01      0x00000003      0x00000000      0x00000000
---------------------------------
